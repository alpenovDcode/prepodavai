# Руководство по тестированию компонентов

## Компоненты для тестирования

### 1. ImageResultDisplay
**Путь:** `src/components/ImageResultDisplay.tsx`

**Функциональность:**
- Отображение сгенерированных изображений
- Состояния загрузки и ошибок
- Скачивание изображений
- Показ метаданных (стиль, тип)

**Тестовые сценарии:**
1. ✅ Компонент рендерится с корректным URL изображения
2. ✅ Показывается индикатор загрузки при загрузке изображения
3. ✅ Обрабатывается ошибка загрузки изображения
4. ✅ Кнопка скачивания работает корректно
5. ✅ Отображаются метаданные, если они предоставлены

### 2. GenerationHistory
**Путь:** `src/components/GenerationHistory.tsx`

**Функциональность:**
- Отображение списка прошлых генераций
- Пагинация (загрузка дополнительных записей)
- Детальный просмотр генерации
- Скачивание результатов
- Удаление генераций

**Тестовые сценарии:**
1. ✅ Загрузка истории генераций с сервера
2. ✅ Отображение пустого состояния, если нет генераций
3. ✅ Пагинация работает корректно
4. ✅ Открытие модального окна с деталями генерации
5. ✅ Скачивание текстовых результатов (HTML)
6. ✅ Скачивание изображений
7. ✅ Удаление генерации
8. ✅ Отображение статусов (pending, completed, failed)
9. ✅ Форматирование дат

### 3. InputComposer
**Путь:** `src/components/InputComposer/index.tsx`

**Функциональность:**
- Динамическое отображение полей ввода на основе выбранной функции
- Загрузка файлов (изображения и видео)
- Валидация размера файлов
- Отображение стоимости генерации

**Тестовые сценарии:**
1. ✅ Выбор функции изменяет поля ввода
2. ✅ Загрузка изображений работает корректно
3. ✅ Загрузка видео работает корректно
4. ✅ Валидация размера файлов (10 МБ для изображений, 3 ГБ для видео)
5. ✅ Показ превью загруженных изображений
6. ✅ Отображение стоимости генерации
7. ✅ Обработка ошибок загрузки файлов

### 4. WebAppIndex
**Путь:** `src/components/WebAppIndex.tsx`

**Функциональность:**
- Главный экран приложения
- Инициализация пользователя
- Отображение кредитов
- Запуск генераций
- Отображение результатов

**Тестовые сценарии:**
1. ✅ Инициализация пользователя при загрузке
2. ✅ Отображение баланса кредитов
3. ✅ Запуск генерации через InputComposer
4. ✅ Опрос статуса генерации
5. ✅ Отображение результатов генерации
6. ✅ Обработка ошибок генерации
7. ✅ Навигация к истории генераций

### 5. AuthModal
**Путь:** `src/components/AuthModal.tsx`

**Функциональность:**
- Регистрация пользователя (телефон/пароль)
- Вход пользователя
- Авторизация через Telegram API key

**Тестовые сценарии:**
1. ✅ Переключение между регистрацией и входом
2. ✅ Отправка кода верификации
3. ✅ Верификация кода
4. ✅ Вход через Telegram API key
5. ✅ Обработка ошибок авторизации

### 6. LandingPage
**Путь:** `src/components/LandingPage.tsx`

**Функциональность:**
- Лендинг для неавторизованных пользователей
- Модальное окно авторизации
- Отображение функций приложения

**Тестовые сценарии:**
1. ✅ Отображение лендинга для неавторизованных пользователей
2. ✅ Открытие модального окна авторизации
3. ✅ Отображение всех функций приложения

## API Endpoints для тестирования

### Backend API

1. **POST /api/files/upload** - Загрузка файлов
   - Тест: Загрузка изображения
   - Тест: Загрузка видео
   - Тест: Валидация размера файла

2. **GET /api/files/:hash** - Получение файла
   - Тест: Получение изображения по hash
   - Тест: 404 для несуществующего файла

3. **GET /api/generate/history** - История генераций
   - Тест: Получение списка генераций
   - Тест: Пагинация (limit, offset)
   - Тест: Фильтрация по пользователю

4. **GET /api/generate/:requestId** - Статус генерации
   - Тест: Получение статуса pending
   - Тест: Получение статуса completed
   - Тест: Получение статуса failed

5. **DELETE /api/generate/:requestId** - Удаление генерации
   - Тест: Удаление существующей генерации
   - Тест: 404 для несуществующей генерации
   - Тест: Запрет удаления чужой генерации

## Инструкции по ручному тестированию

### 1. Тестирование загрузки файлов

```bash
# Запустите backend
cd PREPODAVAI/backend
npm run start:dev

# Запустите frontend
cd PREPODAVAI/frontend
npm run dev
```

1. Откройте приложение в браузере
2. Выберите функцию, требующую загрузки изображения (например, "ИИ Фотосессия")
3. Загрузите изображение (< 10 МБ)
4. Проверьте, что превью отображается
5. Попробуйте загрузить файл > 10 МБ - должна появиться ошибка

### 2. Тестирование истории генераций

1. Создайте несколько генераций разных типов
2. Перейдите в раздел "История"
3. Проверьте, что все генерации отображаются
4. Откройте детали генерации
5. Попробуйте скачать результат
6. Попробуйте удалить генерацию

### 3. Тестирование отображения изображений

1. Создайте генерацию изображения
2. Дождитесь завершения
3. Проверьте, что изображение отображается корректно
4. Попробуйте скачать изображение
5. Проверьте метаданные (если есть)

## Автоматическое тестирование

Для полноценного автоматического тестирования необходимо установить:

```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom jest jest-environment-jsdom @types/jest
```

Пример теста (см. `src/components/__tests__/components.test.tsx`):

```typescript
import { render, screen } from '@testing-library/react'
import ImageResultDisplay from '../ImageResultDisplay'

test('renders image with correct URL', () => {
  render(<ImageResultDisplay imageUrl="https://example.com/image.png" />)
  const img = screen.getByAltText('')
  expect(img).toHaveAttribute('src', 'https://example.com/image.png')
})
```

## Известные проблемы

1. **Ошибки TypeScript линтера**: Ошибки связаны с отсутствием типов React в некоторых файлах. Это не влияет на функциональность, но рекомендуется установить `@types/react` и `@types/react-dom`.

2. **Telegram WebApp SDK**: Некоторые функции могут не работать вне Telegram Mini App. Используйте проверку `isTelegramWebApp` перед вызовом Telegram API.

## Следующие шаги

- [ ] Установить зависимости для автоматического тестирования
- [ ] Написать unit-тесты для всех компонентов
- [ ] Написать integration-тесты для API endpoints
- [ ] Настроить CI/CD для автоматического запуска тестов

